// Inclusive Language Filter
// Checks messages for non-inclusive language and sends gentle educational reminders.

var conductLinks = "\nIn case of doubts please check our <https://bcneng.org/coc|Code of Conduct> and/or our <https://bcneng.org/netiquette|Netiquette> ";

var filters = [
    // English
    { pattern: "you guys", reply: "Instead of *guys*, perhaps you mean *pals*? You can read more information about it at https://www.dictionary.com/e/you-guys/... *[Please consider editing your message so it's more inclusive]*" },
    { pattern: "these guys", reply: "Instead of *guys*, perhaps you mean *gang*? You can read more information about it at https://www.dictionary.com/e/you-guys/... *[Please consider editing your message so it's more inclusive]*" },
    { pattern: "my guys", reply: "Instead of *guys*, perhaps you mean *crew*? You can read more information about it at https://www.dictionary.com/e/you-guys/... *[Please consider editing your message so it's more inclusive]*" },
    { pattern: "those guys", reply: "Instead of *guys*, perhaps you mean *people*? You can read more information about it at https://www.dictionary.com/e/you-guys/... *[Please consider editing your message so it's more inclusive]*" },
    { pattern: "hey guys", reply: "Instead of *guys*, perhaps you mean *y'all*? You can read more information about it at https://www.dictionary.com/e/you-guys/... *[Please consider editing your message so it's more inclusive]*" },
    { pattern: "hi guys", reply: "Instead of *guys*, perhaps you mean *everyone*? You can read more information about it at https://www.dictionary.com/e/you-guys/... *[Please consider editing your message so it's more inclusive]*" },
    { pattern: "the guys", reply: "Instead of *guys*, perhaps you mean *folks*? You can read more information about it at https://www.dictionary.com/e/you-guys/... *[Please consider editing your message so it's more inclusive]*" },
    { pattern: "(?:^|\\W)guys(?:$|[^\\w+])", reply: "Instead of *guys*, have you considered a more gender-neutral pronoun like *folks*? You can read more information about it at https://www.dictionary.com/e/you-guys/... *[Please consider editing your message so it's more inclusive]*" },
    { pattern: "(?:^|\\W)crazy(?:$|[^\\w+])", reply: "Using the word *crazy* is considered by some to be insensitive to sufferers of mental illness, maybe you mean *outrageous*, *unthinkable*, *nonsensical*, *incomprehensible*? Have you considered a different adjective like *ridiculous*? You can read more information about it at https://www.selfdefined.app/definitions/crazy/" },
    { pattern: "(?:^|\\W)insane(?:$|[^\\w+])", reply: "The word *insane* is considered by some to be insensitive to sufferers of mental illness. Perhaps you mean *outrageous*, *unthinkable*, *nonsensical*, *incomprehensible*? Have you considered a different adjective like *ridiculous*? You can read more information about it at https://www.selfdefined.app/definitions/crazy/" },
    { pattern: "(?:^|\\W)slave(?:$|[^\\w+])", reply: "If you are referring to a data replication strategy, please consider a term such as \"follower\" or \"replica\". You can read more information about it at https://www.selfdefined.app/definitions/master-slave/" },
    { pattern: "(?:^|\\W)whitelist(?:$|[^\\w+])", reply: "Instead of *whitelist*, perhaps you mean *allowlist*? You can read more information in https://www.linkedin.com/pulse/allowlist-blocklist-better-terms-everyone-lets-use-them-rob-black/ ... *[Please consider editing your message so it's more inclusive]*" },
    { pattern: "(?:^|\\W)blacklist(?:$|[^\\w+])", reply: "Instead of *blacklist*, perhaps you mean *blocklist*? You can read more information in https://www.linkedin.com/pulse/allowlist-blocklist-better-terms-everyone-lets-use-them-rob-black/ ... *[Please consider editing your message so it's more inclusive]*" },
    // Spanish
    { pattern: "(?:^|\\W)chicos(?:$|[^\\w+])", reply: "En vez de *chicos*, quizá quisiste decir *chiques*, *colegas*, *grupo*, *personas*? Para más información (en inglés), puedes consultar https://www.dictionary.com/e/you-guys/... *[Considera editar tu mensaje para que sea más inclusivo]*" },
];

function removeAccents(str) {
    return str.normalize("NFD").replace(/[\u0300-\u036f]/g, "");
}

var handler = {
    name: "inclusive-language",
    description: "Checks messages for non-inclusive language and sends educational reminders",
    channels: ["*"],
    priority: 10,
    enabled: true,
    skipBots: true,

    handle: function(message) {
        var text = removeAccents(message.text.toLowerCase());

        for (var i = 0; i < filters.length; i++) {
            var filter = filters[i];
            var regex = new RegExp(filter.pattern, "i");

            if (regex.test(text)) {
                message.replyEphemeral(filter.reply + conductLinks);
                console.info("Sent inclusive language reminder for pattern:", filter.pattern);
                return HANDLED;
            }
        }

        return SKIP;
    }
};
